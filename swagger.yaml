openapi: 3.0.0
info:
  title: Mentor API
  version: 0.2.2
  description: |
    API for managing and analyzing git-based code repositories.

    ### Key Features:
    - Repository management and life-time analysis
    - Branch and snapshot tracking
    - Automatic language detection
    - System-generated reports, issues, scores, and insights
    - User management of issue actions, comments, severity, and assignments

    ### Pagination:
    List endpoints support pagination using 'page' and 'per_page' query parameters.
    The default page size is 20 items, and the maximum is 100.

    ### Change Log:
    #### v0.2.0:
    - Added CI/CD integration endpoints under /ci path
    - New schemas for CI/CD analysis requests and results
    #### v0.1.0:
    - Initial release of the Mentor API
    - Advanced sorting and filtering capabilities
    - Cross-resource search endpoint
    - Example responses for key endpoints
    - Basic CRUD operations for repositories, branches, and snapshots
    - System-generated reports, issues, scores, and insights
#
#    ### Sorting:
#    Most list endpoints support sorting using the 'sort' query parameter.
#    Use comma-separated field names, prefixed with '-' for descending order.
#    Example: sort=name,-created_at
#
#    ### Filtering:
#    Advanced filtering is available using the 'filter' query parameter.
#    Use JSON format to specify complex filter conditions.
#    Example: filter={"severity":["high","critical"],"status":"open"}

servers:
- url: /api/v1
#- url: http://localhost:8080/api/v1
#- url: http://localhost:4201/api/v1

paths:
  /auth/login:
    post:
      security: []
      summary: Authenticate a user
      description: |
        This endpoint authenticates a user and returns a JWT access token and a refresh token.
        The access token should be used for subsequent API calls in the Authorization header.
        The refresh token can be used to obtain a new access token when the current one expires.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
        required: true
      responses:
        "200":
          description: Successful authentication
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  refresh_token:
                    type: string

  /auth/token:
    post:
      security: []
      summary: Generate a new access token using refresh token
      description: |
        Use this endpoint to obtain a new access token when the current one expires.
        This helps maintain a seamless user experience without requiring frequent logins.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
        required: true
      responses:
        "200":
          description: New access token generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string

  /auth/refresh:
    post:
      security: []
      summary: Refresh access token (legacy alias)
      description: |
        Legacy alias for `/auth/token`. Allows clients that still call `/auth/refresh`
        to obtain a new access token using their refresh token.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
        required: true
      responses:
        "200":
          description: New access token generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string

  /auth/logout:
    post:
      security:
      - BearerAuth: []
      summary: Logout and invalidate session
      description: |
        Logs out the current user and invalidates their session.
        This endpoint should be called when the user wants to end their session.
      responses:
        "200":
          description: Successfully logged out
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Successfully logged out"
        "401":
          description: Unauthorized - invalid or missing token

  /jobs/{jobKey}:
    get:
      security:
      - BearerAuth: []
      summary: Get job status by job key
      description: |
        Retrieves the current status and details of a job using its job key.
        This endpoint works for all job types (clone, snapshot, analysis, etc.).
        The job key is typically returned when creating async operations.
      parameters:
      - name: jobKey
        in: path
        required: true
        schema:
          type: string
        description: The unique job key identifier
        example: "r-123-rb-456-rbl-789@infer_points"
      responses:
        "200":
          description: Job status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatus'
        "404":
          description: Job not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Job not found"
        "401":
          description: Unauthorized - invalid or missing token

  /search:
    get:
      security:
      - BearerAuth: []
      summary: Search across multiple resources
      description: |
        Performs a search across repositories, branches, snapshots, and issues.
        Use the 'q' parameter to specify the search query, and 'type' to limit the search to specific resources.
      parameters:
      - $ref: '#/components/parameters/PageParam'
      - $ref: '#/components/parameters/PerPageParam'
      - name: q
        in: query
        description: Search query string
        required: true
        schema:
          type: string
      - name: type
        in: query
        description: Limit search to a specific resource type
        schema:
          type: string
          enum: [repository, branch, snapshot, issue]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResults'
        "400":
          description: Bad request - invalid search parameters
        "401":
          description: Unauthorized - invalid or missing token

  /users:
    get:
      security:
      - BearerAuth: []
      summary: List all users
      description: |
        Retrieves a list of all users in the system.
        The list includes basic information about each user such as id, username, email, and role.
      parameters:
      - $ref: '#/components/parameters/PageParam'
      - $ref: '#/components/parameters/PerPageParam'
      - $ref: '#/components/parameters/SortParam'
      - $ref: '#/components/parameters/FilterParam'
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
              example:
                data:
                - id: 1
                  name: John Doe
                  email: john@example.com
                  role: Developer
                - id: 2
                  name: Jane Smith
                  email: jane@example.com
                  role: Admin
                pagination:
                  total_items: 50
                  total_pages: 3
                  current_page: 1
                  per_page: 20
    post:
      security:
      - BearerAuth: []
      summary: Create a new user
      description: |
        Creates a new user account. Only users with edit privileges can create users.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUser'
      responses:
        "201":
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        "400":
          description: Invalid request payload
        "403":
          description: Forbidden - insufficient privileges
        "409":
          description: Conflict - user with the same email already exists

  /users/{userId}:
    get:
      security:
      - BearerAuth: []
      summary: Get user details
      description: |
        Retrieves detailed information about a specific user.
      parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        "404":
          description: User not found
    put:
      security:
      - BearerAuth: []
      summary: Update user profile
      description: |
        Updates the profile information for a specific user.
        Users can only update their own profile unless they have admin privileges.
      parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUser'
        required: true
      responses:
        "200":
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        "403":
          description: Forbidden - insufficient privileges
        "404":
          description: User not found
    delete:
      security:
      - BearerAuth: []
      summary: Delete a user
      description: |
        Deletes a user account. Users cannot delete their own record. Only users with edit privileges can delete other users.
      parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "204":
          description: User deleted successfully
        "400":
          description: Invalid request
        "403":
          description: Forbidden - insufficient privileges
        "404":
          description: User not found

  /users/{userId}/password:
    put:
      security:
      - BearerAuth: []
      summary: Change user password
      description: |
        Changes the password for a specific user.
        Users can only change their own password unless they have admin privileges.
        Requires the current password for verification.
      parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePassword'
        required: true
      responses:
        "200":
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password changed successfully"
        "400":
          description: Invalid request - current password incorrect or new password doesn't meet requirements
        "403":
          description: Forbidden - insufficient privileges
        "404":
          description: User not found

  /users/password-reset:
    post:
      security: []
      summary: Request password reset
      description: |
        Initiates a password reset process for a user by email.
        This endpoint is public and does not require authentication.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetRequest'
        required: true
      responses:
        "200":
          description: Password reset initiated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password reset instructions sent to your email"
        "400":
          description: Invalid request - email not found or invalid
        "429":
          description: Too many requests - rate limited

  /repositories/{repositoryId}/git-credentials:
    get:
      security:
      - BearerAuth: []
      summary: List git credentials for repository
      description: |
        Lists all git credentials for a specific repository.
        Only users with access to the repository can view its credentials.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
        description: Repository ID
      responses:
        "200":
          description: List of git credentials for the repository
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GitCredentials'
        "401":
          description: Unauthorized - invalid or missing token
        "403":
          description: Forbidden - insufficient privileges
        "404":
          description: Repository not found

    post:
      security:
      - BearerAuth: []
      summary: Create git credentials for repository
      description: |
        Creates new git credentials for a specific repository.
        Only users with access to the repository can create credentials for it.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
        description: Repository ID
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGitCredentials'
        required: true
      responses:
        "201":
          description: Git credentials created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitCredentials'
        "400":
          description: Invalid request - missing required fields
        "401":
          description: Unauthorized - invalid or missing token
        "403":
          description: Forbidden - insufficient privileges
        "404":
          description: Repository not found
        "409":
          description: Conflict - credentials already exist for this URL

  /repositories/{repositoryId}/git-credentials/{credentialId}:
    get:
      security:
      - BearerAuth: []
      summary: Get git credentials for repository
      description: |
        Retrieves specific git credentials by ID for a repository.
        Only users with access to the repository can view its credentials.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
        description: Repository ID
      - name: credentialId
        in: path
        required: true
        schema:
          type: integer
        description: Git credentials ID
      responses:
        "200":
          description: Git credentials found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitCredentials'
        "401":
          description: Unauthorized - invalid or missing token
        "403":
          description: Forbidden - insufficient privileges
        "404":
          description: Repository or git credentials not found

    put:
      security:
      - BearerAuth: []
      summary: Update git credentials for repository
      description: |
        Updates existing git credentials for a repository.
        Only users with access to the repository can update its credentials.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
        description: Repository ID
      - name: credentialId
        in: path
        required: true
        schema:
          type: integer
        description: Git credentials ID
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateGitCredentials'
        required: true
      responses:
        "200":
          description: Git credentials updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitCredentials'
        "400":
          description: Invalid request - missing required fields
        "401":
          description: Unauthorized - invalid or missing token
        "403":
          description: Forbidden - insufficient privileges
        "404":
          description: Repository or git credentials not found

    delete:
      security:
      - BearerAuth: []
      summary: Delete git credentials for repository
      description: |
        Deletes git credentials by ID for a repository.
        Only users with access to the repository can delete its credentials.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
        description: Repository ID
      - name: credentialId
        in: path
        required: true
        schema:
          type: integer
        description: Git credentials ID
      responses:
        "204":
          description: Git credentials deleted successfully
        "401":
          description: Unauthorized - invalid or missing token
        "403":
          description: Forbidden - insufficient privileges
        "404":
          description: Repository or git credentials not found

  /repositories:
    get:
      security:
        - BearerAuth: []
      summary: List all repositories
      description: |
        Retrieves a list of all repositories that have been added to the system for analysis.
        This includes repositories across all users, so appropriate filtering may be necessary.
      parameters:
      - $ref: '#/components/parameters/PageParam'
      - $ref: '#/components/parameters/PerPageParam'
      - $ref: '#/components/parameters/SortParam'
      - $ref: '#/components/parameters/FilterParam'
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
              example:
                data:
                - id: 1
                  name: awesome-project
                  gitUrl: https://github.com/user/awesome-project.git
                  defaultBranch: main
                - id: 2
                  name: legacy-app
                  gitUrl: https://github.com/company/legacy-app.git
                  defaultBranch: master
                pagination:
                  total_items: 30
                  total_pages: 2
                  current_page: 1
                  per_page: 20
    post:
      security:
      - BearerAuth: []
      summary: Add a new repository for analysis
      description: |
        Adds a new git repository to the system for analysis. This doesn't create a new repository,
        but rather points the system to an existing git repository for tracking and analysis.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewRepository'
        required: true
      responses:
        "201":
          description: Repository added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Repository'

  /repositories/{repositoryId}:
    get:
      security:
      - BearerAuth: []
      summary: Retrieve specific repository details
      description: |
        Fetches detailed information about a specific repository.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Repository'
    put:
      security:
      - BearerAuth: []
      summary: Update repository details
      description: |
        Updates the details of a specific repository.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRepository'
        required: true
      responses:
        "200":
          description: Repository updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Repository'
    delete:
      security:
      - BearerAuth: []
      summary: Remove a repository from analysis
      description: |
        Removes a repository from the analysis system. This does not delete the actual git repository,
        but rather stops tracking and analyzing it. All associated data will also be removed from the system.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "204":
          description: Repository removed successfully

  /repositories/{repositoryId}/branches:
    get:
      security:
      - BearerAuth: []
      summary: List all branches for a repository
      description: |
        Retrieves a list of all branches for a specific repository that have been added to the system
        for analysis.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - $ref: '#/components/parameters/PageParam'
      - $ref: '#/components/parameters/PerPageParam'
      - $ref: '#/components/parameters/SortParam'
      - $ref: '#/components/parameters/FilterParam'
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
              example:
                data:
                - id: 1
                  name: main
                  lastCommitSha: abc123
                - id: 2
                  name: feature/new-ui
                  lastCommitSha: def456
                pagination:
                  total_items: 5
                  total_pages: 1
                  current_page: 1
                  per_page: 20
    post:
      security:
      - BearerAuth: []
      summary: Add a branch for analysis
      description: |
        Adds a specific branch from the repository for analysis.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewBranch'
        required: true
      responses:
        "201":
          description: Branch added for analysis
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Branch'
        "400":
          description: Bad request - invalid branch name or repository not found
        "401":
          description: Unauthorized - invalid or missing token
        "404":
          description: Repository not found

  /branches/{branchId}:
    get:
      security:
      - BearerAuth: []
      summary: Get specific branch details
      description: |
        Retrieves detailed information about a specific branch.
      parameters:
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Branch'
    put:
      security:
      - BearerAuth: []
      summary: Update branch details
      description: |
        Updates the details of a specific branch.
      parameters:
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBranch'
        required: true
      responses:
        "200":
          description: Branch updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Branch'
    delete:
      security:
      - BearerAuth: []
      summary: Delete a branch
      description: |
        Deletes a branch from the analysis system. This removes the branch and all associated data.
      parameters:
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "204":
          description: Branch deleted successfully

  /repositories/{repositoryId}/branches/{branchId}/snapshots:
    get:
      security:
      - BearerAuth: []
      summary: List all snapshots for a branch
      description: |
        Retrieves a list of all snapshots that have been created for a specific branch.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: query
        schema:
          type: integer
      - $ref: '#/components/parameters/PageParam'
      - $ref: '#/components/parameters/PerPageParam'
      - $ref: '#/components/parameters/SortParam'
      - $ref: '#/components/parameters/FilterParam'
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
              example:
                data:
                - id: 1
                  branchId: 1
                  pointTime: 2023-06-15T10:00:00Z
                  pointRef: abc123
                  languageId: 1
                  contentFiles: 123
                  contentSize: 567890
                  linesOfCode: 456789
                  numberAnomalies: 12
                  numberNotables: 321
                  numberExpressions: 23456
                  score: 678
                - id: 2
                  branchId: 1
                  pointTime: 2023-06-16T11:30:00Z
                  pointRef: def456
                  languageId: 1
                  contentFiles: 124
                  contentSize: 567891
                  linesOfCode: 456790
                  numberAnomalies: 12
                  numberNotables: 322
                  numberExpressions: 23457
                  score: 653
                pagination:
                  total_items: 10
                  total_pages: 1
                  current_page: 1
                  per_page: 20
    post:
      security:
      - BearerAuth: []
      summary: Create new snapshots for a branch
      description: |
        Creates new snapshots for analysis on a specific branch. You can specify either the number
        of snapshots to create or a maximum time duration between snapshots.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: query
        required: false
        schema:
          type: integer
        description: Language ID to select the specific RBL. If not provided, defaults to the first RBL for the branch.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewSnapshots'
        required: true
      responses:
        "201":
          description: Snapshots created successfully (immediate completion)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Snapshot'
        "202":
          description: Snapshot job initiated, check status with job_key
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_key:
                    type: string
                    description: Job key to track snapshot creation progress
                  status:
                    type: string
                    description: Current status (pending, running)
                  message:
                    type: string
                    description: Human-readable status message

  /repositories/{repositoryId}/issues:
    get:
      security:
      - BearerAuth: []
      summary: List all issues for a repository
      description: |
        Retrieves a list of all issues for a specific repository.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - $ref: '#/components/parameters/PageParam'
      - $ref: '#/components/parameters/PerPageParam'
      - $ref: '#/components/parameters/SortParam'
      - $ref: '#/components/parameters/FilterParam'
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
              example:
                data:
                - id: 1
                  title: Potential null pointer dereference
                  severity: high
                  status: open
                  reportedAt: 2023-06-15T10:00:00Z
                - id: 2
                  title: Unused import statement
                  severity: low
                  status: resolved
                  reportedAt: 2023-06-16T11:30:00Z
                pagination:
                  total_items: 15
                  total_pages: 1
                  current_page: 1
                  per_page: 20

  /repositories/{repositoryId}/issues/{issueId}:
    get:
      security:
      - BearerAuth: []
      summary: Get details of a specific issue
      description: |
        Retrieves detailed information about a specific issue.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: issueId
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Issue'
#    put:
#      security:
#      - BearerAuth: []
#      summary: Update an issue
#      description: |
#        Updates the details of a specific issue.
#      parameters:
#      - name: repositoryId
#        in: path
#        required: true
#        schema:
#          type: integer
#      - name: issueId
#        in: path
#        required: true
#        schema:
#          type: string
#      requestBody:
#        content:
#          application/json:
#            schema:
#              $ref: '#/components/schemas/UpdateIssue'
#        required: true
#      responses:
#        "200":
#          description: Issue updated successfully
#          content:
#            application/json:
#              schema:
#                $ref: '#/components/schemas/Issue'

  /repositories/{repositoryId}/analysis-reports:
    get:
      security:
      - BearerAuth: []
      summary: List analysis reports for a repository
      description: |
        Retrieves a list of analysis reports for a specific repository.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - $ref: '#/components/parameters/PageParam'
      - $ref: '#/components/parameters/PerPageParam'
      - $ref: '#/components/parameters/SortParam'
      - $ref: '#/components/parameters/FilterParam'
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
              example:
                data:
                - id: 1
                  title: Code Quality Report - June 2023
                - id: 2
                  title: Security Analysis - Q2 2023
                pagination:
                  total_items: 5
                  total_pages: 1
                  current_page: 1
                  per_page: 20

  /repositories/{repositoryId}/languages:
    get:
      security:
      - BearerAuth: []
      summary: List all programming languages detected in the latest snapshot of the default branch
      description: |
        Retrieves a list of programming languages detected in the repository, based on the latest
        snapshot of the default branch. Each language entry includes the language name and the
        percentage of code written in that language.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BranchLanguage'

  /rbls/{rblId}:
    get:
      security:
      - BearerAuth: []
      summary: Get specific RBL (Repository Branch Language) details
      description: |
        Retrieves detailed information about a specific RBL.
      parameters:
      - name: rblId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RBL'
    put:
      security:
      - BearerAuth: []
      summary: Update RBL details
      description: |
        Updates the details of a specific RBL.
      parameters:
      - name: rblId
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRBL'
        required: true
      responses:
        "200":
          description: RBL updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RBL'
    delete:
      security:
      - BearerAuth: []
      summary: Delete an RBL
      description: |
        Deletes an RBL from the analysis system. This removes the RBL and all associated data.
      parameters:
      - name: rblId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "204":
          description: RBL deleted successfully

  /repositories/{repositoryId}/branches/{branchId}/reports:
    get:
      security:
      - BearerAuth: []
      summary: Get reports for a specific branch (system-generated)
      description: |
        Retrieves the system-generated reports for a specific branch. These reports provide an
        overview of the analysis results, potentially including code quality metrics, potential
        issues, and other relevant information. The content and structure of these reports are
        determined by the system's analysis capabilities.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AnalysisReport'

  /repositories/{repositoryId}/branches/{branchId}/snapshots/{snapId}/issues:
    get:
      security:
      - BearerAuth: []
      summary: Get issues for a specific branch (system-generated)
      description: |
        Fetches a list of issues detected by the system for a specific branch. These issues are
        automatically identified during the analysis process and may include code smells, potential
        bugs, security vulnerabilities, or other areas for improvement.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: snapId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: query
        schema:
          type: integer
      - $ref: '#/components/parameters/PageParam'
      - $ref: '#/components/parameters/PerPageParam'
      - $ref: '#/components/parameters/SortParam'
      - $ref: '#/components/parameters/FilterParam'
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
              example:
                data:
                - id: 1
                  title: Potential null pointer dereference
                - id: 2
                  title: Unused import statement
                pagination:
                  total_items: 15
                  total_pages: 1
                  current_page: 1
                  per_page: 20

  /repositories/{repositoryId}/branches/{branchId}/snapshots/{snapId}/issues/{issueId}:
    put:
      security:
      - BearerAuth: []
      summary: Update an issue within a snapshot
      description: |
        Updates an issue detected within a specific snapshot. This allows users to assign issues,
        add comments, categorize issues, and perform other management actions.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
        description: Repository ID
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
        description: Branch ID
      - name: snapId
        in: path
        required: true
        schema:
          type: integer
        description: Snapshot ID (RBLPoint_ID)
      - name: issueId
        in: path
        required: true
        schema:
          type: string
        description: Issue ID (expressionInstanceId as integer)
      - name: languageId
        in: query
        required: false
        schema:
          type: integer
        description: Language ID to select the specific RBL. If not provided, defaults to the first RBL for the branch.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateIssue'
        required: true
      responses:
        "200":
          description: Issue updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Issue'
        "400":
          description: Invalid request parameters
        "401":
          description: Unauthorized
        "404":
          description: Issue not found in the specified snapshot

  /repositories/{repositoryId}/branches/{branchId}/languages/{languageId}/issues:
    get:
      security:
      - BearerAuth: []
      summary: Get issues for a specific RBL (Repository Branch Language)
      description: |
        Fetches a list of issues detected by the system for a specific RBL (Repository Branch Language).
        This endpoint provides issues for a specific branch and language combination.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: page
        in: query
        required: false
        schema:
          type: integer
          default: 1
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
          default: 20
      responses:
        "200":
          description: List of issues for the RBL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
              example:
                data:
                - id: 1
                  title: Potential null pointer dereference
                - id: 2
                  title: Unused import statement
                pagination:
                  total_items: 15
                  total_pages: 1
                  current_page: 1
                  per_page: 20
        "401":
          description: Unauthorized
        "404":
          description: RBL not found

  /repositories/{repositoryId}/branches/{branchId}/languages/{languageId}/authors:
    get:
      security:
      - BearerAuth: []
      summary: Get authors for a specific RBL (Repository Branch Language)
      description: |
        Retrieves a list of all authors (code contributors) for a specific RBL (Repository Branch Language).
        Each author includes their names, emails, and contribution scores. This is read-only data
        derived from git commit history.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: page
        in: query
        required: false
        schema:
          type: integer
          default: 1
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
          default: 20
      responses:
        "200":
          description: List of authors for the RBL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
              example:
                data:
                - id: 1
                  names: ["John Doe", "john.doe"]
                  emails: ["john.doe@example.com"]
                  rawPointScore: 85
                  emaMentorScore: 82
                - id: 2
                  names: ["Jane Smith"]
                  emails: ["jane@example.com", "jane.smith@company.com"]
                  rawPointScore: 90
                  emaMentorScore: 88
                pagination:
                  total_items: 25
                  total_pages: 2
                  current_page: 1
                  per_page: 20
        "401":
          description: Unauthorized
        "404":
          description: RBL not found

  /repositories/{repositoryId}/branches/{branchId}/snapshots/{snapId}/authors:
    get:
      security:
      - BearerAuth: []
      summary: Get authors for a specific snapshot (RBL Point)
      description: |
        Retrieves a list of all authors (code contributors) for a specific snapshot (RBL Point).
        Each author includes their names, emails, contribution count, and scores for this specific
        snapshot. This is read-only data derived from git commit history for the snapshot point.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: snapId
        in: path
        required: true
        schema:
          type: integer
          description: Snapshot ID (RBLPoint_ID)
      - name: languageId
        in: query
        required: false
        schema:
          type: integer
          description: Language ID to select the specific RBL. If not provided, defaults to the first RBL for the branch.
      - name: page
        in: query
        required: false
        schema:
          type: integer
          default: 1
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
          default: 20
      responses:
        "200":
          description: List of authors for the snapshot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
              example:
                data:
                - id: 1
                  names: ["John Doe", "john.doe"]
                  emails: ["john.doe@example.com"]
                  count: 15
                  rawPointScore: 85
                  emaMentorScore: 82
                - id: 2
                  names: ["Jane Smith"]
                  emails: ["jane@example.com"]
                  count: 8
                  rawPointScore: 90
                  emaMentorScore: 88
                pagination:
                  total_items: 25
                  total_pages: 2
                  current_page: 1
                  per_page: 20
        "401":
          description: Unauthorized
        "404":
          description: Snapshot or RBL not found

  /repositories/{repositoryId}/branches/{branchId}/languages/{languageId}/watch-configs:
    get:
      security:
      - BearerAuth: []
      summary: List watch configurations for an RBL
      description: |
        Retrieves all watch configurations for a specific RBL (Repository Branch Language).
        Watch configurations allow users to monitor score changes and issue introductions/removals.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: page
        in: query
        required: false
        schema:
          type: integer
          default: 1
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
          default: 20
      responses:
        "200":
          description: List of watch configurations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
        "401":
          description: Unauthorized
        "404":
          description: RBL not found
    post:
      security:
      - BearerAuth: []
      summary: Create a watch configuration for an RBL
      description: |
        Creates a new watch configuration for a specific RBL. Watch configurations allow users to
        monitor score changes and issue introductions/removals. The user making the request will be
        automatically associated with the watch configuration.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewWatchConfig'
        required: true
      responses:
        "201":
          description: Watch configuration created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchConfig'
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
        "404":
          description: RBL not found

  /repositories/{repositoryId}/branches/{branchId}/languages/{languageId}/watch-configs/{configId}:
    get:
      security:
      - BearerAuth: []
      summary: Get a specific watch configuration
      description: |
        Retrieves a specific watch configuration by its ID for an RBL.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: configId
        in: path
        required: true
        schema:
          type: integer
          description: Watch configuration ID
      responses:
        "200":
          description: Watch configuration retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchConfig'
        "401":
          description: Unauthorized
        "404":
          description: Watch configuration or RBL not found
    put:
      security:
      - BearerAuth: []
      summary: Update a watch configuration
      description: |
        Updates an existing watch configuration. Only the user who created the watch configuration
        or users with appropriate privileges can update it.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: configId
        in: path
        required: true
        schema:
          type: integer
          description: Watch configuration ID
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWatchConfig'
        required: true
      responses:
        "200":
          description: Watch configuration updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchConfig'
        "400":
          description: Invalid request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - user does not have permission to update this watch configuration
        "404":
          description: Watch configuration or RBL not found
    delete:
      security:
      - BearerAuth: []
      summary: Delete a watch configuration
      description: |
        Deletes a watch configuration. Only the user who created the watch configuration or users
        with appropriate privileges can delete it.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: configId
        in: path
        required: true
        schema:
          type: integer
          description: Watch configuration ID
      responses:
        "204":
          description: Watch configuration deleted successfully
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - user does not have permission to delete this watch configuration
        "404":
          description: Watch configuration or RBL not found

  /repositories/{repositoryId}/branches/{branchId}/languages/{languageId}/files:
    get:
      security:
      - BearerAuth: []
      summary: List files for an RBL
      description: |
        Retrieves a list of all files in a specific RBL (Repository Branch Language).
        Files are the repository-level entries that represent files in the codebase.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: page
        in: query
        required: false
        schema:
          type: integer
          default: 1
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
          default: 20
      responses:
        "200":
          description: List of files for the RBL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
        "401":
          description: Unauthorized
        "404":
          description: RBL not found

  /repositories/{repositoryId}/branches/{branchId}/languages/{languageId}/files/{fileId}:
    get:
      security:
      - BearerAuth: []
      summary: Get a specific file for an RBL
      description: |
        Retrieves detailed information about a specific file in an RBL.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: fileId
        in: path
        required: true
        schema:
          type: integer
          description: File ID (RBLFile_ID)
      responses:
        "200":
          description: File retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        "401":
          description: Unauthorized
        "404":
          description: File or RBL not found

  /repositories/{repositoryId}/branches/{branchId}/languages/{languageId}/files/{fileId}/versions:
    get:
      security:
      - BearerAuth: []
      summary: List file versions for a file
      description: |
        Retrieves all versions (git refs) of a specific file in an RBL.
        Each version represents the file at a specific git reference.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: fileId
        in: path
        required: true
        schema:
          type: integer
          description: File ID (RBLFile_ID)
      - name: page
        in: query
        required: false
        schema:
          type: integer
          default: 1
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
          default: 20
      responses:
        "200":
          description: List of file versions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
        "401":
          description: Unauthorized
        "404":
          description: File or RBL not found

  /repositories/{repositoryId}/branches/{branchId}/languages/{languageId}/expressions:
    get:
      security:
      - BearerAuth: []
      summary: List expressions for an RBL
      description: |
        Retrieves a list of all expressions in a specific RBL (Repository Branch Language).
        Expressions are code patterns that have been analyzed for quality issues.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: page
        in: query
        required: false
        schema:
          type: integer
          default: 1
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
          default: 20
      responses:
        "200":
          description: List of expressions for the RBL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
        "401":
          description: Unauthorized
        "404":
          description: RBL not found

  /repositories/{repositoryId}/branches/{branchId}/languages/{languageId}/expressions/{expressionId}:
    get:
      security:
      - BearerAuth: []
      summary: Get a specific expression for an RBL
      description: |
        Retrieves detailed information about a specific expression in an RBL.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: languageId
        in: path
        required: true
        schema:
          type: integer
          description: Language enum value (0=C, 1=CPP, 2=PYTHON, etc.)
      - name: expressionId
        in: path
        required: true
        schema:
          type: integer
          description: Expression ID (RBLExpression_ID)
      responses:
        "200":
          description: Expression retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Expression'
        "401":
          description: Unauthorized
        "404":
          description: Expression or RBL not found

  /repositories/{repositoryId}/branches/{branchId}/snapshots/{snapId}/file-versions:
    get:
      security:
      - BearerAuth: []
      summary: List file versions used in a snapshot
      description: |
        Retrieves all file versions that are present in a specific snapshot (RBL Point).
        This shows which versions of files were analyzed at this snapshot point.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
      - name: snapId
        in: path
        required: true
        schema:
          type: integer
          description: Snapshot ID (RBLPoint_ID)
      - name: languageId
        in: query
        required: false
        schema:
          type: integer
          description: Language ID to select the specific RBL. If not provided, defaults to the first RBL for the branch.
      - name: page
        in: query
        required: false
        schema:
          type: integer
          default: 1
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
          default: 20
      responses:
        "200":
          description: List of file versions in the snapshot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
        "401":
          description: Unauthorized
        "404":
          description: Snapshot or RBL not found

  /repositories/{repositoryId}/branches/{branchId}/snapshots/{snapId}/expression-insights/{issueId}:
    get:
      security:
      - BearerAuth: []
      summary: Get expression insight for an issue
      description: |
        Fetches expression insights for a specific issue within a snapshot. This endpoint will return
        a job_key if the insight is being generated, or the expression insight data if already complete.
        The privacy_mode parameter controls what type of insights are returned.
      parameters:
      - name: repositoryId
        in: path
        required: true
        schema:
          type: integer
        description: Repository ID
      - name: branchId
        in: path
        required: true
        schema:
          type: integer
        description: Branch ID
      - name: snapId
        in: path
        required: true
        schema:
          type: integer
        description: Snapshot ID (RBLPoint_ID)
      - name: issueId
        in: path
        required: true
        schema:
          type: string
        description: Issue ID in format "expr-id:expr-index" (e.g., "123:456")
      - name: privacy_mode
        in: query
        required: false
        schema:
          type: string
          enum: [Private, PrimeForm, Public]
          default: Public
        description: 'Privacy mode for insight generation (default: Public)'
      - name: languageId
        in: query
        required: false
        schema:
          type: integer
        description: Language ID to select the specific RBL. If not provided, defaults to the first RBL for the branch.
      responses:
        "200":
          description: Expression insight retrieved successfully
          content:
            application/json:
              schema:
                type: object
                description: Expression insight data or job_key if still processing
              examples:
                completed:
                  value:
                    insight: "This is a complex expression that could be simplified..."
                    expression: "if (x && y || z)"
                pending:
                  value:
                    job_key: "r-123-rb-456-rbl-789@generate_insight"
                    status: "pending"
                    message: "Insight generation in progress"
        "202":
          description: Insight generation initiated, use job_key to check status
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_key:
                    type: string
                    description: Job key to track insight generation progress
                  status:
                    type: string
                    description: Current status (pending, running)
                  message:
                    type: string
                    description: Human-readable status message
        "404":
          description: Issue not found in the specified snapshot
        "401":
          description: Unauthorized
        "400":
          description: Invalid request parameters

#  /ci/analyze:
#    post:
#      security:
#      - CIAuth: []
#      summary: Trigger a CI/CD analysis
#      description: Initiates an analysis for a specific commit in the context of CI/CD integration.
#      requestBody:
#        content:
#          application/json:
#            schema:
#              $ref: '#/components/schemas/CIAnalysisRequest'
#        required: true
#      responses:
#        "202":
#          description: Analysis initiated successfully
#          content:
#            application/json:
#              schema:
#                $ref: '#/components/schemas/CIAnalysisInitiatedResponse'
#        "400":
#          description: Invalid request
#        "401":
#          description: Unauthorized
#        "404":
#          description: Repository not found
#
#  /ci/results:
#    get:
#      security:
#      - CIAuth: []
#      summary: Retrieve CI/CD analysis results
#      description: Fetches the results of a previously initiated CI/CD analysis.
#      parameters:
#      - name: analysis_id
#        in: query
#        required: true
#        schema:
#          type: string
#      responses:
#        "200":
#          description: Analysis results retrieved successfully
#          content:
#            application/json:
#              schema:
#                $ref: '#/components/schemas/CIAnalysisResults'
#        "401":
#          description: Unauthorized
#        "404":
#          description: Analysis not found

components:
  parameters:
    PageParam:
      name: page
      in: query
      schema:
        type: integer
        default: 1
        minimum: 1
      description: Page number for pagination
    PerPageParam:
      name: per_page
      in: query
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100
      description: Number of items per page (max 100)
    SortParam:
      name: sort
      in: query
      schema:
        type: string
      description: |
        Comma-separated list of fields to sort by.
        Prefix a field with '-' for descending order.
        Example: sort=name,-created_at
    FilterParam:
      in: query
      name: filter
      schema:
        type: string
      description: |
        JSON-encoded filter conditions.
        Example: filter={"severity":["high","critical"],"status":"open"}

  schemas:
    PaginatedResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
        pagination:
          $ref: '#/components/schemas/PaginationInfo'

    PaginationInfo:
      type: object
      properties:
        total_items:
          type: integer
        total_pages:
          type: integer
        current_page:
          type: integer
        per_page:
          type: integer

    SearchResults:
      type: object
      properties:
        repositories:
          type: array
          items:
            $ref: '#/components/schemas/Repository'
        branches:
          type: array
          items:
            $ref: '#/components/schemas/Branch'
        snapshots:
          type: array
          items:
            $ref: '#/components/schemas/Snapshot'
        issues:
          type: array
          items:
            $ref: '#/components/schemas/Issue'

    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
        role:
          type: string
          enum: [Developer, Lead, Admin, Owner, Demo]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UpdateUser:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
        role:
          type: string
          enum: [Developer, Lead, Admin, Owner, Demo]
    CreateUser:
      type: object
      required: [name, email, password, role]
      properties:
        name:
          type: string
          description: Display name for the user
        email:
          type: string
          format: email
          description: Unique email address for the user
        password:
          type: string
          format: password
          description: Initial password for the user
        role:
          type: string
          description: Role assigned to the user
          enum: [Developer, Lead, Admin, Owner, Demo]

    ChangePassword:
      type: object
      required:
      - current_password
      - new_password
      properties:
        current_password:
          type: string
          description: The user's current password
        new_password:
          type: string
          minLength: 8
          description: The new password (minimum 8 characters)
        confirm_password:
          type: string
          description: Confirmation of the new password

    PasswordResetRequest:
      type: object
      required:
      - email
      properties:
        email:
          type: string
          format: email
          description: The email address of the user requesting password reset

    Repository:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        gitUrl:
          type: string
        defaultBranch:
          type: string
        sourceRoot:
          type: string
          description: Resolved source root path on disk
        gitRoot:
          type: string
          description: Resolved git root path on disk
        rblId:
          type: integer
          format: int32
          description: Primary Repo-Branch-Language identifier for the default branch/language

    NewRepository:
      required:
      - name
      - gitUrl
      type: object
      properties:
        name:
          type: string
        gitUrl:
          type: string
        description:
          type: string
        gitUsername:
          type: string
          description: Optional git username for private repositories
        gitPassword:
          type: string
          description: Optional git password/token for private repositories

    UpdateRepository:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        defaultBranch:
          type: string
        gitRemote:
          type: string
        gitRoot:
          type: string
        sourceRoot:
          type: string
        repoIconLink:
          type: string
        repoLink:
          type: string
        autoUpdateInterval:
          type: integer
        allFiles:
          type: boolean
        publicInsights:
          type: boolean
        prefetchInsights:
          type: boolean
        shareVotes:
          type: boolean
        tags:
          type: string
        tabSize:
          type: integer
    
    Language:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string

    Branch:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        lastCommitSha:
          type: string
        revList:
          type: string
          description: Raw rev-list data for this branch (backend-defined format)
        languages:
          type: array
          items:
            $ref: '#/components/schemas/Language'
        lifetimeMentorScore:
          type: integer

    NewBranch:
      required:
      - name
      type: object
      properties:
        name:
          type: string

    UpdateBranch:
      type: object
      properties:
        name:
          type: string
        gitRemote:
          type: string
        gitBranch:
          type: string

    BranchLanguage:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        branchId:
          type: integer
        languageId:
          type: integer
        percentage:
          type: number
          format: float
        lifetimeMentorScore:
          type: number
          nullable: true
          format: float
        lastScore:
          type: number
          nullable: true
          format: float
        lastNumberIssues:
          type: integer
          nullable: true
        lastAnalyzedAt:
          type: string
          nullable: true
          format: date-time

    Snapshot:
      type: object
      properties:
        id:
          type: integer
        branchId:
          type: integer
        pointTime:
          type: string
          format: date-time
        pointRef:
          type: string
        languages:
          type: array
          items:
            $ref: '#/components/schemas/Language'
        contentFiles:
          type: integer
        contentSize:
          type: integer
        linesOfCode:
          type: integer
        numberAnomalies:
          type: integer
        numberNotables:
          type: integer
        numberExpressions:
          type: integer
        score:
          type: integer

    NewSnapshots:
      required:
      - method
      - value
      type: object
      properties:
        method:
          type: string
          enum: [count, duration, single]
        value:
          type: integer
        ref:
          type: string

    LanguageSnapshot:
      type: object
      properties:
        id:
          type: integer
        snapshotId:
          type: integer
        languageId:
          type: integer
        contentFiles:
          type: integer
        contentSize:
          type: integer
        linesOfCode:
          type: integer
        numberAnomalies:
          type: integer
        numberNotables:
          type: integer
        numberExpressions:
          type: integer
        score:
          type: number
          format: float

    AnalysisReport:
      type: object
      properties:
        id:
          type: integer
        repoId:
          type: integer
        snapshotId:
          type: integer
        title:
          type: string
        content:
          type: string
        createdAt:
          type: string
          format: date-time

    Issue:
      type: object
      properties:
        id:
          type: string
        repoId:
          type: integer
        expressionInstanceId:
          type: integer
        snippet:
          type: string
        priority:
          type: string
          enum: [critical, high, medium, low]
        file:
          type: string
        file_ln:
          type: integer
        action:
          type: string
          nullable: true
          enum: [ignore, investigate, simplify, fix, potential_crash, potential_security_issue]
        categoryId:
          type: integer
          nullable: true
        comment:
          type: string
        reporterId:
          type: integer
          nullable: true
        reportedAt:
          type: string
          nullable: true
          format: date-time
        assigneeId:
          type: integer
          nullable: true
        assignedAt:
          type: string
          nullable: true
          format: date-time
        updatedAt:
          type: string
          nullable: true
          format: date-time

    UpdateIssue:
      type: object
      properties:
        comment:
          type: string
        categoryId:
          type: integer
          nullable: true
        assigneeId:
          type: integer
          nullable: true

    Author:
      type: object
      description: |
        Represents a code author (contributor) for a specific RBL. Authors are identified
        by their names and emails extracted from git commit history. This is read-only data.
      properties:
        id:
          type: integer
          description: Unique author ID within the RBL context
        names:
          type: array
          items:
            type: string
          description: List of name variations used by this author
        emails:
          type: array
          items:
            type: string
          description: List of email addresses used by this author
        rawPointScore:
          type: integer
          description: Raw point score for this author. Default -1 if not calculated.
        emaMentorScore:
          type: integer
          description: EMA mentor score for this author. Default -1 if not calculated.

    CIAnalysisRequest:
      required:
      - repoId
      - commit_sha
      - branch
      type: object
      properties:
        repoId:
          type: integer
        commit_sha:
          type: string
        branch:
          type: string
        analysis_depth:
          type: string
          enum: [quick, full]
          default: quick

    CIAnalysisInitiatedResponse:
      type: object
      properties:
        analysis_id:
          type: string
        status:
          type: string
          enum: [in_progress, queued]
        estimated_completion_time:
          type: string
          format: date-time

    CIAnalysisResults:
      type: object
      properties:
        analysis_id:
          type: string
        status:
          type: string
          enum: [in_progress, completed, failed]
        repository_id:
          type: integer
        commit_sha:
          type: string
        branch:
          type: string
        analysis_depth:
          type: string
          enum: [quick, full]
        completed_at:
          type: string
          format: date-time
        summary:
          type: object
          properties:
            total_issues:
              type: integer
            critical_issues:
              type: integer
            high_issues:
              type: integer
            medium_issues:
              type: integer
            low_issues:
              type: integer
            score:
              type: number
              format: float
        issues:
          type: array
          items:
            $ref: '#/components/schemas/CIAnalysisIssue'
        pass_fail_status:
          type: string
          enum: [pass, fail]
        failure_reason:
          type: string

    CIAnalysisIssue:
      type: object
      properties:
        id:
          type: string
        severity:
          type: string
          enum: [critical, high, medium, low]
        description:
          type: string
        file_path:
          type: string
        line_number:
          type: integer
        link:
          type: string
          format: uri

    RBL:
      type: object
      properties:
        id:
          type: integer
        branchId:
          type: integer
        language:
          type: string
        status:
          type: string
        created:
          type: string
          format: date-time
        updated:
          type: string
          format: date-time
        deleted:
          type: boolean
        earliestPointDate:
          type: string
          format: date-time
        authorCount:
          type: integer

    UpdateRBL:
      type: object
      properties:
        language:
          type: string
        status:
          type: string
        deleted:
          type: boolean

    JobStatus:
      type: object
      properties:
        job_key:
          type: string
          description: The unique job key identifier
        status:
          type: string
          enum: [pending, running, completed, failed, error, canceled]
          description: Current status of the job
        action:
          type: string
          description: The type of action being performed (e.g., clone, infer_points, analyze)
        description:
          type: string
          description: Human-readable description of the job
        created_at:
          type: string
          format: date-time
          description: When the job was created
        started_at:
          type: string
          format: date-time
          nullable: true
          description: When the job started processing
        finished_at:
          type: string
          format: date-time
          nullable: true
          description: When the job completed (successfully or with failure)
        progress:
          type: integer
          minimum: 0
          maximum: 100
          nullable: true
          description: Job progress percentage (0-100)
        error_message:
          type: string
          nullable: true
          description: Error message if the job failed
        repository_id:
          type: integer
          nullable: true
          description: Associated repository ID (if applicable)
        branch_id:
          type: integer
          nullable: true
          description: Associated branch ID (if applicable)
        rbl_id:
          type: integer
          nullable: true
          description: Associated RBL ID (if applicable)

    GitCredentials:
      type: object
      properties:
        id:
          type: integer
          description: Unique identifier for the git credentials
        url:
          type: string
          description: Git repository URL pattern (use '*' for global credentials)
        username:
          type: string
          description: Git username
        password:
          type: string
          description: Git password or token (masked in responses)
        created_at:
          type: string
          format: date-time
          description: When the credentials were created
        updated_at:
          type: string
          format: date-time
          description: When the credentials were last updated

    CreateGitCredentials:
      type: object
      required:
        - url
        - username
        - password
      properties:
        url:
          type: string
          description: Git repository URL pattern (use '*' for global credentials)
        username:
          type: string
          description: Git username
        password:
          type: string
          description: Git password or token

    UpdateGitCredentials:
      type: object
      properties:
        username:
          type: string
          description: Git username
        password:
          type: string
          description: Git password or token

    WatchConfig:
      type: object
      properties:
        id:
          type: integer
          description: Watch configuration ID
        rblId:
          type: integer
          description: RBL ID this watch configuration is for
        scoreEnabled:
          type: boolean
          description: Whether to watch for score changes
        scoreChangeDir:
          type: integer
          description: Direction of score change to watch (0=Increases, 1=Decreases, 2=Either)
        scoreChangeAmount:
          type: integer
          description: Amount of score change to trigger notification
        scoreChangeType:
          type: integer
          description: Type of score change (0=Points, 1=Percentage)
        scoreFreq:
          type: integer
          description: Frequency check value
        scoreFreqType:
          type: integer
          description: Frequency check type
        issuesEnabled:
          type: boolean
          description: Whether to watch for issue changes
        anomaliesIntroduced:
          type: boolean
          description: Watch for anomalies being introduced
        notablesIntroduced:
          type: boolean
          description: Watch for notables being introduced
        introducedAmount:
          type: integer
          description: Amount threshold for introduced issues
        issuesIntroducedChangeType:
          type: integer
          description: Change type for introduced issues (0=Issues, 1=Percentage)
        anomaliesRemoved:
          type: boolean
          description: Watch for anomalies being removed
        notablesRemoved:
          type: boolean
          description: Watch for notables being removed
        removedAmount:
          type: integer
          description: Amount threshold for removed issues
        issuesRemovedChangeType:
          type: integer
          description: Change type for removed issues (0=Issues, 1=Percentage)
        issuesFreq:
          type: integer
          description: Frequency check value for issues
        issuesFreqType:
          type: integer
          description: Frequency check type for issues

    NewWatchConfig:
      type: object
      properties:
        scoreEnabled:
          type: boolean
          description: Whether to watch for score changes
        scoreChangeDir:
          type: integer
          description: Direction of score change to watch (0=Increases, 1=Decreases, 2=Either)
        scoreChangeAmount:
          type: integer
          description: Amount of score change to trigger notification
        scoreChangeType:
          type: integer
          description: Type of score change (0=Points, 1=Percentage)
        scoreFreq:
          type: integer
          description: Frequency check value
        scoreFreqType:
          type: integer
          description: Frequency check type
        issuesEnabled:
          type: boolean
          description: Whether to watch for issue changes
        anomaliesIntroduced:
          type: boolean
          description: Watch for anomalies being introduced
        notablesIntroduced:
          type: boolean
          description: Watch for notables being introduced
        introducedAmount:
          type: integer
          description: Amount threshold for introduced issues
        issuesIntroducedChangeType:
          type: integer
          description: Change type for introduced issues (0=Issues, 1=Percentage)
        anomaliesRemoved:
          type: boolean
          description: Watch for anomalies being removed
        notablesRemoved:
          type: boolean
          description: Watch for notables being removed
        removedAmount:
          type: integer
          description: Amount threshold for removed issues
        issuesRemovedChangeType:
          type: integer
          description: Change type for removed issues (0=Issues, 1=Percentage)
        issuesFreq:
          type: integer
          description: Frequency check value for issues
        issuesFreqType:
          type: integer
          description: Frequency check type for issues

    UpdateWatchConfig:
      type: object
      properties:
        scoreEnabled:
          type: boolean
          description: Whether to watch for score changes
        scoreChangeDir:
          type: integer
          description: Direction of score change to watch (0=Increases, 1=Decreases, 2=Either)
        scoreChangeAmount:
          type: integer
          description: Amount of score change to trigger notification
        scoreChangeType:
          type: integer
          description: Type of score change (0=Points, 1=Percentage)
        scoreFreq:
          type: integer
          description: Frequency check value
        scoreFreqType:
          type: integer
          description: Frequency check type
        issuesEnabled:
          type: boolean
          description: Whether to watch for issue changes
        anomaliesIntroduced:
          type: boolean
          description: Watch for anomalies being introduced
        notablesIntroduced:
          type: boolean
          description: Watch for notables being introduced
        introducedAmount:
          type: integer
          description: Amount threshold for introduced issues
        issuesIntroducedChangeType:
          type: integer
          description: Change type for introduced issues (0=Issues, 1=Percentage)
        anomaliesRemoved:
          type: boolean
          description: Watch for anomalies being removed
        notablesRemoved:
          type: boolean
          description: Watch for notables being removed
        removedAmount:
          type: integer
          description: Amount threshold for removed issues
        issuesRemovedChangeType:
          type: integer
          description: Change type for removed issues (0=Issues, 1=Percentage)
        issuesFreq:
          type: integer
          description: Frequency check value for issues
        issuesFreqType:
          type: integer
          description: Frequency check type for issues

    File:
      type: object
      properties:
        id:
          type: integer
          description: File ID (RBLFile_ID)
        fileId:
          type: integer
          description: Internal file ID
        name:
          type: string
          description: File name (resolved from Name_ID)
        folderId:
          type: integer
          nullable: true
          description: Parent folder ID (if any)
        folderName:
          type: string
          nullable: true
          description: Parent folder name resolved from Name_ID (if any)
        folderPath:
          type: string
          nullable: true
          description: Slash-separated folder path relative to the repository root (if any)
        fullPath:
          type: string
          description: Full path to the file (folder path plus file name)
        language:
          type: string
          description: Programming language

    Expression:
      type: object
      properties:
        id:
          type: integer
          description: Expression ID (RBLExpression_ID)
        expressionId:
          type: integer
          description: Internal expression ID
        snippetId:
          type: integer
          description: Snippet ID this expression is based on
        score:
          type: number
          format: float
          description: Expression score
        cost:
          type: number
          format: float
          description: Expression cost
        expressionClass:
          type: integer
          description: Expression class
        state:
          type: integer
          description: Expression state
        expressionType:
          type: integer
          description: Expression type
        snippetText:
          type: string
          description: Snippet text for this expression
        snippetLanguage:
          type: string
          description: Programming language of the snippet
        snippetMode:
          type: integer
          description: Snippet extraction mode
        snippetType:
          type: integer
          description: Snippet type/category
        expressionInstanceId:
          type: integer
          nullable: true
          description: Expression instance ID (RBLExpressionInstance_ID) from the latest snapshot when available
        expressionInstanceIndex:
          type: integer
          nullable: true
          description: Expression instance index within the latest snapshot when available
        fileId:
          type: integer
          nullable: true
          description: File ID (RBLFile_ID) associated with the expression in the latest snapshot when available
        fileName:
          type: string
          nullable: true
          description: File name associated with the expression when available
        fileFullPath:
          type: string
          nullable: true
          description: Full file path associated with the expression when available
        fileVersionId:
          type: integer
          nullable: true
          description: File version ID (RBLFileVersion_ID) from the latest snapshot when available
        fileVersionRef:
          type: string
          nullable: true
          description: Mentor reference for the file version from the latest snapshot when available
        expressionInfos:
          type: array
          description: Additional occurrence/classification information for the expression
          items:
            $ref: '#/components/schemas/ExpressionInfo'

    ExpressionInfo:
      type: object
      properties:
        occurrence:
          type: number
          format: float
          description: Occurrence value for the expression
        cls:
          type: integer
          description: Classification value for the expression
        known:
          type: boolean
          description: Indicates whether the expression is known

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: JWT token obtained from /auth/login or /auth/token

    CIAuth:
      type: http
      scheme: bearer
      description: CI-specific authentication token

security:
  - BearerAuth: []
  - CIAuth: []